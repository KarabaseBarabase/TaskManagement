@model List<TaskManagement.Models.Mission>

@{
    ViewData["Title"] = "Scheduler";
    var staff = Model.Select(m => m.AssignedTo).Distinct().ToArray();
    
    var staffColors = new Dictionary<string, string>();
    var random = new Random();
    foreach (var person in staff)
    {
        string color = String.Format("#{0:X6}", random.Next(0x1000000)); 
        staffColors[person] = color;
    }
    DateTime currentDate = new DateTime(2025, 03, 25);
    int startHour = 8;  
    int endHour = 19;    
}

<div class="container" style="font-family: Arial, sans-serif;">
    <div class="bg-light p-3 mb-3 border-bottom">
        Добро пожаловать! <a href="#">Войти</a>
    </div>

    <div class="mb-3">
        <button type="button" class="btn btn-outline-secondary">Неделя</button>
        <button type="button" class="btn btn-outline-secondary">Месяц</button>
        <button type="button" class="btn btn-secondary">Сотрудники</button>
        <span>@currentDate.ToString("dd MMM yyyy")</span>
        <span class="float-right">
            <a href="#">Сегодня</a>
            <a href="#">&lt;</a>
            <a href="#">&gt;</a>
        </span>
    </div>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Time</th>
                @foreach (var person in staff)
                {
                    <th class="text-center">@person</th>
                }
            </tr>
        </thead>
        <tbody>
            @for (int hour = startHour; hour <= endHour; hour++)
            {
                <tr>
                    <th class="text-center align-middle">@hour:00</th>
                    @for (int staffIndex = 0; staffIndex < staff.Length; staffIndex++)
                    {
                        <td class="position-relative" style="height: 80px; vertical-align: top; position: relative">
                            @{
                                var missionsForThisCell = Model.Where (m => m.CreatedDate.Year == currentDate.Year &&
                                    m.CreatedDate.Month == currentDate.Month &&
                                    m.CreatedDate.Day == currentDate.Day &&
                                    m.CreatedDate.Hour == hour &&
                                    m.AssignedTo.Contains(staff[staffIndex]));
                                foreach (var mission in missionsForThisCell)
                                {
                                    string backgroundColor = staffColors[mission.AssignedTo];
                                    string textColor = "black";

                                    var topOffset = (mission.CreatedDate.Minute / 60.0) * 80; 
                                    var height = (mission.Duration / 60.0) * 80; 
                                    var missionTime = mission.CreatedDate.ToString("HH:mm");

                                    <div class="position-absolute p-1" style="top: @topOffset px; left: 0; width: 100%; height: @height px; background-color: @backgroundColor; color: @textColor; box-sizing: border-box; font-size: smaller;">
                                        @missionTime - @(Convert.ToDateTime(missionTime).AddMinutes(mission.Duration).ToString("HH:mm"))
                                        <br />
                                        @mission.Name
                                    </div>
                                }
                            }
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
</div>